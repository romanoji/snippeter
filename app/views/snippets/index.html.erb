<% title 'Recent snippets' %>

<%= javascript_tag do %>
    var ready = function() {
        $('#snippets').append('<%= j render @snippets %>');
        <% if @snippets.next_page %>
            $('.pagination').replaceWith('<%= j will_paginate @snippets %>');
        <% else %>
            $(window).off('scroll');
            $('.pagination').remove();
        <% end %>
    }

    $(document).ready(ready);
<% end %>

<div class="page-header">
  <%= link_to new_snippet_path, :class => 'btn btn-add' do %>
    <span class="glyphicon glyphicon-plus"></span>
    New Snippet
  <% end %>
  <h1>Recent snippets</h1>
</div>

<% if @snippets.size > 0 %>
<div>
  <table class="table table-striped table-bordered table-hover">
    <thead>
      <tr>
        <th class="snippet-header">Snippet</th>
        <th>Lang</th>
        <th>Description</th>
        <th>Last modification</th>
        <th class="button-header"></th>
        <th class="button-header"></th>
      </tr>
    </thead>

    <tbody id="snippets">
      <% render @snippets %>
    </tbody>
  </table>
</div>

<div id="infinite-scrolling">
  <%= will_paginate %>
</div>

<%= javascript_tag do %>
    $(document).ready(function() {
        // Make rows clickable
        $(".table tr").on('click', function(event) {
            var target = $(event.target);
            if (target.is(":not(a)") && target.is(":not(span)")) {
                var href = $(this).data("link");
                if (href) {
                    window.location.href = href;
                }
            }
        });
    });
<% end %>

<% else %>
    <em>No snippets found.</em>
<% end %>